<!doctype html>

<html lang="en">
<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script><script>window.angular || document.write('<script src="js/angular.min.js"><\/script>')</script>
<head>
	<meta charset="utf-8">

	<title>Waiting for an opponent</title>
	<meta name="author" content="Carlos Ruiz">

	<link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body ng-app="myApp" ng-controller="myCtrl">
	<p>Please wait while we match you with another user,<br>we can't continue until all users are ready...<br>
		<progress max="{{ NUMBER_OF_USERS }}" style="width: 250px; height: 20px;" ng-value="prog"></progress><span style="position: absolute; left: 0; width: 100%;"><b style="line-height: 20px" ng-bind="prog_int + '%'"></b></span><br>
		<span ng-bind="'(' + prog + ' out of {{ NUMBER_OF_USERS }} users ready)'"></span></p>
	<p><img src="{{ url_for('static', filename='images/loading_spinner.gif') }}" loop="infinite" alt="" width="32" height="32" title="Waiting for a match... Please wait :)"/></p>
	<iframe src="wait_progress" width="0" height="0" scrolling="no" style="visibility: hidden; display: none" seamless="seamless"></iframe>
	<script language="javascript">
		var app = angular.module('myApp', []);
		app.controller('myCtrl', function($scope) {
			$scope.prog = 0;
			$scope.prog_int = 0;
			window.updateProg = function (p, redir) {
				$scope.$apply(function () {
					$scope.prog = p;
					$scope.prog_int = parseInt(100*p/{{ NUMBER_OF_USERS }});
					if (redir || p>={{ NUMBER_OF_USERS }}) {
						window.location = "match";
					}
				});
			};
		});
	</script>
</body>
</html>
